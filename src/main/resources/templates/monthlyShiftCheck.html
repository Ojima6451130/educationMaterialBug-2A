<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="Thu, 01 Dec 1994 16:00:00 GMT">
<title>月別シフト確認画面</title>
<link rel="stylesheet" media="all"
	th:href="@{/css/monthlyShiftCheck.css}" />
<link
	href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
	rel="stylesheet">
<link rel="icon" href="/img/monthlyShiftCheck/street_fighter2.png">

<script type="text/javascript" th:src="@{/js/common.js}"></script>
<script type="text/javascript" th:src="@{/js/message.js}"></script>
</head>

<body>
	<div id="wrapper">
		<div id="header">
			<table class="centered-container">
				<tr>
					<td id="headLeft">
						<form action="/kikin/menu" method="post">
							<input value="戻る" type="submit" class="smallButton" />
						</form>
					</td>
					<td id="headCenter"><img
						src="/img/monthlyShiftCheck/monthlyShiftCheck_title.png"
						alt="MonthlyShiftCheck" class="header-logo"></td>
					<td id="headRight"><input value="ログアウト" type="button"
						class="smallButton" onclick="logout()" /></td>
				</tr>
			</table>
		</div>
		<div style="text-align: center;">
			<form id="searchForm" action="/kikin/monthlyShiftCheck/search"
				method="post" th:object="${MonthlyShiftCheckForm}">
				<label>表示年月：</label> <select name="yearMonth" id="yearMonth"
					style="width: 5%; color: black;">
					<option th:each="yearMonth : ${yearMonthValues}"
						th:value="${yearMonth}" th:selected="${yearMonth} == *{yearMonth}"
						th:inline="text" inputmode="text">[[${yearMonth}]]</option>
				</select>
				<button type="submit" value="search">検索</button>
				<input type="hidden" name="countPage"
					th:value="${monthlyShiftCheckForm.countPage}" /> <input
					type="hidden" name="offset"
					th:value="${monthlyShiftCheckForm.offset}" /> <a
					th:href="@{/kikin/monthlyShiftCheck/monthlyShiftCheckPage(paging='back', yearMonth=${monthlyShiftCheckForm.yearMonth},offset=${monthlyShiftCheckForm.offset},countPage=${monthlyShiftCheckForm.countPage})}">前へ</a>
				<a
					th:href="@{/kikin/monthlyShiftCheck/monthlyShiftCheckPage(paging='next', yearMonth=${monthlyShiftCheckForm.yearMonth},offset=${monthlyShiftCheckForm.offset},countPage=${monthlyShiftCheckForm.countPage},maxPage=${monthlyShiftCheckForm.maxPage})}">次へ</a>
				<span th:text="${monthlyShiftCheckForm.countPage}"></span>/ <span
					th:text="${monthlyShiftCheckForm.maxPage}"></span>
			</form>
		</div>
		<div id="businessBody">
			<table class="daysTable">
				<thead style="display: block; position: sticky;">
					<tr class="tableHeader">
						<td style="width: 150px; text-align: center;">&nbsp;</td>
						<td th:each="dateBean : ${dateBeanList}"
							style="width: 40px; text-align: center;"><span
							th:text="${dateBeanStat.count}"></span></td>
					</tr>
					<tr class="tableHeader">
						<td style="width: 150px; text-align: center; white-space: nowrap;">
							社員名</td>
						<td th:each="dateBean : ${dateBeanList}"
							style="width: 40px; text-align: center; vertical-align: middle;">
							<span
							th:if="${dateBean.weekDay == saturday && !dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: blue;">[[${dateBean.weekDay}]]</span>
							<span
							th:if="${dateBean.weekDay == sunday || dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: red;">[[${dateBean.weekDay}]]</span>
							<span
							th:unless="${dateBean.weekDay == saturday || dateBean.weekDay == sunday || dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: black;">[[${dateBean.weekDay}]]</span>
						</td>
					</tr>
				</thead>
				<tbody style="display: block; max-height: 400px; height: 490px;">
					<tr th:each="monthlyShiftCheck : ${monthlyShiftCheckBean}"
						class="tableBody">
						<td class="tableBody" style="width: 150px; text-align: center;">
							<span th:text="${monthlyShiftCheck.employeeName}"></span>
						</td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol01}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol02}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol03}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol04}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol05}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol06}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol07}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol08}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol09}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol10}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol11}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol12}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol13}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol14}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol15}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol16}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol17}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol18}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol19}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol20}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol21}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol22}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol23}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol24}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol25}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol26}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol27}"></td>
						<td class="tableBody" style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol28}"></td>
						<td th:if="${dateBeanList.size() > 28}" class="tableBody"
							style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol29}"></td>
						<td th:if="${dateBeanList.size() > 29}" class="tableBody"
							style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol30}"></td>
						<td th:if="${dateBeanList.size() > 30}" class="tableBody"
							style="width: 40px; text-align: center;"
							th:text="${monthlyShiftCheck.symbol31}"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div id="footer" style="padding: 0;">
			<table>
				<tr>
					<td id="footLeft"><input value="凡例表示" type="button"
						class="longButton" onclick="openWindow()" />
						<form id="excelForm" style="display: inline;"
							action="/kikin/monthlyShiftCheck/print" method="post"
							th:object="${MonthlyShiftCheckForm}">
							<input id="yearMonth" type="hidden" th:field="*{yearMonth}"
								th:value="${yearMonth}"> <input type="submit"
								class="smallButton" id="btn_excel" value="印刷">
						</form></td>
					<td id="footCenter" style="text-align: right;"></td>
					<td id="footRight"></td>
				</tr>
			</table>
		</div>
	</div>


	<div class="character-bar">
		<img id="ryu" src="/img/monthlyShiftCheck/ryu.png" alt="キャラ1"> <img
			src="/img/monthlyShiftCheck/ken.png" alt="キャラ2"> <img
			src="/img/monthlyShiftCheck/edomondo.png" alt="キャラ3"> <img
			src="/img/monthlyShiftCheck/cyunri.png" alt="キャラ4"> <img
			src="/img/monthlyShiftCheck/buranka.png" alt="キャラ5"> <img
			src="/img/monthlyShiftCheck/zangiefu.png" alt="キャラ6"> <img
			src="/img/monthlyShiftCheck/gairu.png" alt="キャラ7"> <img
			src="/img/monthlyShiftCheck/darushimu.png" alt="キャラ8">
	</div>

	<script>

	// ====== 状態管理 ======
	let commandMode = false;      // コマンド受付中？
	let hadokenMode = false;      // 波動拳モード？
	let commandSequence = [];     // 入力履歴

	// ====== リュウをクリックでコマンド受付開始 ======
	document.getElementById("ryu").addEventListener("click", () => {
	    commandMode = true;
	    hadokenMode = false;
	    commandSequence = [];

	    
	    alert("波動拳のコマンドを入力してください！");
	});

	// ====== キーボードのコマンド判定 ======
	document.addEventListener("keydown", (e) => {

    if (!commandMode) return;

    // 下 or 右 を押したら記録
    if (e.key === "ArrowDown" || e.key === "ArrowRight") {
        commandSequence.push(e.key);
    }

    // P を押した瞬間に ↓ → が揃ってるか確認
    if (e.key === "p" || e.key === "P") {
        const seq = commandSequence.join(",");

        // ↓ → の順で入力されていれば成功
        if (seq === "ArrowDown,ArrowRight") {
            activateHadoken();
        }else {
            failHadoken();   
        }

        // 成否にかかわらずコマンドリセット
        commandSequence = [];
    }

});


	// ====== 波動拳発動 ======
	function activateHadoken() {
	    

	    commandMode = false;
	    hadokenMode = true;
	    
	    

	    // マウスカーソルを波動拳に変更
	    document.body.style.cursor = "url('/img/Hadoken.png') 16 16, auto";

	    alert("波動拳！シフトをクリックすると削除できます！");
	}
	
	function failHadoken() {
	    

	    commandMode = false;

	    alert("コマンド入力失敗！連帯責任で誰かのシフトが増えます！");

	    addRandomShift();
	}

	function addRandomShift() {
	    // シフトセルを全部取得
	    const cells = Array.from(document.querySelectorAll(".tableBody"))
	        .filter(cell => cell.textContent.trim() === "");

	    // 空きがなければ何もしない
	    if (cells.length === 0) return;

	    // ランダムに1セル選択
	    const target = cells[Math.floor(Math.random() * cells.length)];

	    // シフト追加
	    target.textContent = "日";  // ← 好きな記号にしてOK
	    target.style.backgroundColor = "#FFCCCC";

	    
	}

	

	// ====== セルクリック時の削除処理 ======
	document.addEventListener("click", (e) => {

	    if (!hadokenMode) return;

	    // シフトセル以外では反応しない
	    if (!e.target.classList.contains("tableBody")) return;

	    // セル内容削除
	    e.target.textContent = "";
	    e.target.style.backgroundColor = "lightblue";

	    

	    // 波動拳モード終了 ＆ カーソルを戻す
	    hadokenMode = false;
	    document.body.style.cursor = "auto";

	    alert("シフトを削除しました！");
	});


</script>
</body>

</html>

