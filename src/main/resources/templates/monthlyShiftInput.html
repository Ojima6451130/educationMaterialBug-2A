<!-- /**
 * ファイル名：monthlyShiftInput.html
 *
 * 変更履歴
 * 1.0  2010/09/13 Kazuya.Naraki
 * 2.0  2024/05/15 Sho.Kiyota
 */ -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Expires" content="Thu, 01 Dec 1994 16:00:00 GMT">
<title>月別シフト入力画面</title>
<link rel="stylesheet" media="all"
	th:href="@{/css/monthlyShiftInput.css}" />
<link
	href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap"
	rel="stylesheet">


<link rel="icon" href="/img/monthlyShiftInput/pikumin4.png">
<script type="text/javascript" th:src="@{/js/common.js}"></script>
<script type="text/javascript" th:src="@{/js/message.js}"></script>
<style>
#resize select {
	box-sizing: border-box;
	width: 100%; /* ← 必要に応じて */
}
</style>
</head>

<body>
	<div id="wrapper">
		<div id="header">
			<table class="centered-container">
				<tr>
					<td id="headLeft">
						<form action="/kikin/menu" method="post">
							<input value="戻る" type="submit" class="smallButton" />
						</form>
					</td>
					<td id="headCenter"><img
						src="/img/monthlyShiftInput/monthlyShiftInput.png" alt="月別シフト入力"
						class="header-logo"></td>
					<td id="headRight"><input value="ログアウト" type="button"
						class="smallButton" onclick="logout()" /></td>
				</tr>
			</table>
		</div>
		<div style="text-align: center;">
			<form id="searchForm" action="/kikin/monthlyShiftInput/search"
				method="post" th:object="${monthlyShiftInputForm}">
				<label>表示年月：</label> <select name="yearMonth" id="yearMonth"
					style="width: 5%; color: black;">
					<option th:each="yearMonth : ${yearMonthValues}"
						th:value="${yearMonth}" th:selected="${yearMonth} == *{yearMonth}"
						th:inline="text" inputmode="text">[[${yearMonth}]]</option>
				</select>

				<button type="submit" value="search">検索</button>
				<!-- </form> -->
				<a
					th:href="@{/kikin/monthlyShiftInput/monthlyShiftInputPage(paging='back', yearMonth=${monthlyShiftInputForm.yearMonth},offset=${monthlyShiftInputForm.offset},countPage=${monthlyShiftInputForm.countPage})}">前へ</a>
				<a
					th:href="@{/kikin/monthlyShiftInput/monthlyShiftInputPage(paging='next', yearMonth=${monthlyShiftInputForm.yearMonth},offset=${monthlyShiftInputForm.offset},countPage=${monthlyShiftInputForm.countPage},maxPage=${monthlyShiftInputForm.maxPage})}">次へ</a>
				<span th:text="${monthlyShiftInputForm.countPage}"></span>/ <span
					th:text="${monthlyShiftInputForm.maxPage}"></span>
		</div>
		<div id="businessBody">
			<table class="daysTable" id="resize">
				<thead style="display: block; position: sticky;">
					<tr class="tableHeader">
						<td style="width: 150px; text-align: center;">&nbsp;</td>
						<td th:each="dateBean : ${dateBeanList}"
							style="width: 40px; text-align: center;"><span
							th:text="${dateBeanStat.count}"></span></td>
					</tr>
					<tr class="tableHeader">
						<td style="width: 150px; text-align: center; white-space: nowrap;">
							社員名</td>
						<td th:each="dateBean : ${dateBeanList}"
							style="width: 40px; text-align: center; vertical-align: middle;">
							<span
							th:if="${dateBean.weekDay == saturday && !dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: blue;">[[${dateBean.weekDay}]]</span>
							<span
							th:if="${dateBean.weekDay == sunday || dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: red;">[[${dateBean.weekDay}]]</span>
							<span
							th:unless="${dateBean.weekDay == saturday || dateBean.weekDay == sunday || dateBean.publicHolidayFlg}"
							th:value="${dateBean.weekDay}" style="color: black;">[[${dateBean.weekDay}]]</span>
						</td>
					</tr>
				</thead>
				<tbody style="display: block; max-height: 400px;">
					<tr th:each="monthlyShiftInput : ${monthlyShiftInputBean}"
						class="tableBodyMonthly">
						<td class="tableBodyMonthly"
							style="width: 150px; text-align: center;"><span
							th:text="${monthlyShiftInput.employeeName}"></span></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId01" name="shiftIdList[0]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId01} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId01}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId02" name="shiftIdList[1]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId02} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId02}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId03" name="shiftIdList[2]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId03} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId03}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId04" name="shiftIdList[3]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId04} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId04}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId05" name="shiftIdList[4]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId05} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId05}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId06" name="shiftIdList[5]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId06} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId06}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId07" name="shiftIdList[6]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId07} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId07}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId08" name="shiftIdList[7]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId08} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId08}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId09" name="shiftIdList[8]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId09} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId09}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId10" name="shiftIdList[9]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId10} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId10}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId11" name="shiftIdList[10]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId11} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId11}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId12" name="shiftIdList[11]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId12} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId12}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId13" name="shiftIdList[12]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId13} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId13}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId14" name="shiftIdList[13]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId14} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId14}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId15" name="shiftIdList[14]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId15} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId15}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId16" name="shiftIdList[15]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId16} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId16}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId17" name="shiftIdList[16]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId17} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId17}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId18" name="shiftIdList[17]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId18} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId18}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId19" name="shiftIdList[18]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId19} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId19}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId20" name="shiftIdList[19]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId20} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId20}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId21" name="shiftIdList[20]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId21} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId21}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId22" name="shiftIdList[21]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId22} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId22}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId23" name="shiftIdList[22]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId23} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId23}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId24" name="shiftIdList[23]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId24} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId24}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId25" name="shiftIdList[24]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId25} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId25}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId26" name="shiftIdList[25]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId26} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId26}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId27" name="shiftIdList[26]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId27} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId27}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly"
							style="width: 40px; text-align: center;"><select
							id="shiftId28" name="shiftIdList[27]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId28} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId28}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly" th:if="${dateBeanList.size() > 28}"
							style="width: 40px; text-align: center;"><select
							id="shiftId29" name="shiftIdList[28]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId29} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId29}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>
						<td class="tableBodyMonthly" th:if="${dateBeanList.size() > 29}"
							style="width: 40px; text-align: center;"><select
							id="shiftId30" name="shiftIdList[29]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId30} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId30}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>

						<td class="tableBodyMonthly" th:if="${dateBeanList.size() > 30}"
							style="width: 40px; text-align: center;"><select
							id="shiftId31" name="shiftIdList[30]">
								<option th:value="''"
									th:selected="${monthlyShiftInput.shiftId31} == ''"
									th:inline="text"></option>
								<option th:each="shift : ${shiftCmbMap}" th:value="${shift.key}"
									th:selected="${shift.key} == ${monthlyShiftInput.shiftId31}"
									th:inline="text">[[${shift.value}]]</option>
						</select></td>

					</tr>
				</tbody>
			</table>
		</div>
		<div id="bottom-deco">
			<img src="/img/monthlyShiftInput/seibutsu.png" alt=""
				class="bottom-image">
		</div>
		<div id="footer">
			<table>
				<tr>
					<td id="footLeft">
						<div style="margin-left: 50px; white-space: nowrap;">
							<input value="凡例表示" type="button" class="longButton"
								onclick="openWindow()" /> <input value="基本シフト反映" type="submit"
								class="longButton"
								formaction="/kikin/monthlyShiftInput/submitImportKihon" /> <input
								value="出勤希望日反映" type="submit" class="longButton"
								formaction="/kikin/monthlyShiftInput/dateRequest" />
						</div>
					</td>
					<td id="footCenter" style="text-align: right;"></td>
					<td id="footRight"><input type="hidden" name="countPage"
						th:value="${monthlyShiftInputForm.countPage}" /> <input
						type="hidden" name="offset"
						th:value="${monthlyShiftInputForm.offset}" /> <input value="登録"
						type="submit" class="smallButton"
						formaction="/kikin/monthlyShiftInput/regist" /></td>
				</tr>
			</table>
		</div>
		</form>
	</div>
	<img class="pikumin">
	<script>
		function openWindow() {
			// 新しいウィンドウを開く
			window
					.open(
							"/kikin/ShiftPattern",
							"windowBPopup",
							"menubar=no, toolbar=no, scrollbars=auto, resizable=yes, width=520px, height=650px");

		}
		
		
		const PIKUMIN_COUNT = 64;

		const pikuminImages = [
			"/img/monthlyShiftInput/pikumin_red.png",
			"/img/monthlyShiftInput/pikumin_blue.png",
			"/img/monthlyShiftInput/pikumin_yellow.png",
			"/img/monthlyShiftInput/pikumin_rock.png",
			"/img/monthlyShiftInput/pikumin_feather.png",
			"/img/monthlyShiftInput/pikumin_white.png",
			"/img/monthlyShiftInput/pikumin_purple.png",
			"/img/monthlyShiftInput/pikumin_ice.png"
		];

		const pikumins = [];
		let mouseX = window.innerWidth / 2;
		let mouseY = window.innerHeight / 2;

		let lastMoveTime = Date.now();
		const STOP_TIME = 600; // ms
		const CIRCLE_RADIUS = 80;

		const CURSOR_OFFSET_X = -30;
		const CURSOR_OFFSET_Y = -25;

		document.addEventListener("mousemove", e => {
		    mouseX = e.clientX + CURSOR_OFFSET_X;
		    mouseY = e.clientY + CURSOR_OFFSET_Y;
		    lastMoveTime = Date.now();
		});


		for (let i = 0; i < PIKUMIN_COUNT; i++) {
			const p = document.createElement("img");

			p.src = pikuminImages[Math.floor(Math.random() * pikuminImages.length)];
			p.className = "pikumin pikumin-walk";
			p.style.position = "fixed";

			

			document.body.appendChild(p);

			pikumins.push({
				  el: p,
				  x: Math.random() * window.innerWidth,
				  y: Math.random() * window.innerHeight,

				  speed: 0.009 + Math.random() * 0.03,        // 通常追従
				  gatherSpeed: 0.016 + Math.random() * 0.024,  // 集合（個体差大）

				  angle: (Math.PI * 2 / PIKUMIN_COUNT) * i,

				  wobble: Math.random() * Math.PI * 2,       // ルート用
				  wobbleSpeed: 0.04 + Math.random() * 0.06   // 揺れ速度
				});

		}

		function animate() {

			  // マウスが止まっているか判定
			  const stopped = Date.now() - lastMoveTime > STOP_TIME;

			  pikumins.forEach(p => {

			    // ===== 目標位置 =====
			    let targetX = mouseX;
			    let targetY = mouseY;

			    // マウス停止 → 円形集合
			    if (stopped) {
			      targetX += Math.cos(p.angle) * CIRCLE_RADIUS;
			      targetY += Math.sin(p.angle) * CIRCLE_RADIUS;
			    }

			    // ===== スピード（個体差）=====
			    const moveSpeed = stopped ? p.gatherSpeed : p.speed;

			    // ===== ルートの揺らぎ =====
			    p.wobble += p.wobbleSpeed;
			    const offsetX = Math.cos(p.wobble) * 12;
			    const offsetY = Math.sin(p.wobble) * 12;

			    // ===== 移動 =====
			    p.x += (targetX + offsetX - p.x) * moveSpeed;
			    p.y += (targetY + offsetY - p.y) * moveSpeed;

			    p.el.style.left = p.x + "px";
			    p.el.style.top  = p.y + "px";
			  });

			  requestAnimationFrame(animate);
			}



		animate();
	</script>

</body>

</html>
